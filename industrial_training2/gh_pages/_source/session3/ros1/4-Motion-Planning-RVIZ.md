# Motion Planning using RViz
> In this exercise, we will (finally) learn how to use the MoveIt! RViz plugin to plan and execute motion on a simulated robot. We will explore the different options and constraints associated with both MoveIt! and the RViz plugin.

## Launch the Planning Environment

 1. Source your catkin workspace.

 1. Bring up the planning environment, connected to a ROS-I Simulator node:

    ```
    roslaunch myworkcell_moveit_config myworkcell_planning_execution.launch
    ```

## Plugin Display Options

 1. Find and test the following display options in the Displays panel, _Motion Planning_ display

    * _Scene Robot -> Show Robot Visual_

    * _Scene Robot -> Show Robot Collision_

    * _Planning Request -> Query Start State_

    * _Planning Request -> Query Goal State_

 1. For now, enable display of the _Show Robot Visual_ and _Query Goal State_, leaving _Show Robot Collision_ and _Query Start State_ disabled

    <p align="center"><img src=http://aeswiki.datasys.swri.edu/rositraining/indigo/Exercises/3.5?action=AttachFile&do=get&target=Displays.png /></p>

 1. Select the `Panel -> Motion Planning - Trajectory Slider` menu option to display a trajectory-preview slider.
 
    * _this slider allows for detailed review of the last planned trajectory_

## Basic Motion

 1. In the _Motion Planning_ panel, select the _Planning_ tab

 1. Under the _Query_ section, expand the _Select Goal State_ section

    * _select \<random valid\> and press Update_
    * _observe the goal position in the graphics window_

 1. Click _Plan_ to see the robot motion generated by the MoveIt! planning libraries

    * _deselect Displays -> Motion Planning -> Planned Path -> Loop Animation to stop the cyclic display_
    * _select Displays -> Motion Planning -> Planned Path -> Show Trail to show the swept path_

 1. Click _Execute_ to run the motion on the Industrial Robot Simulator

    * _observe that the multi-colored scene robot display updates to show that the robot has "moved" to the goal position_

 1. Repeat steps 2-5 a few more times

    * _try using the interactive marker to manually move the robot to a desired position_
    * _try using a named pose (e.g. "straight up")_

    <p align="center"><img src=http://aeswiki.datasys.swri.edu/rositraining/indigo/Exercises/3.5?action=AttachFile&do=get&target=MotionQueries.png /></p>

## Beyond the Basics

 1. Experiment with different Planning Algorithms

    * _select Context tab, choose a Planning Algorithm (drop-down box next to "OMPL")_

    * _the RRTkConfigDefault algorithm is often much faster_

 1. Environment Obstacles

    * Adjust the Goal State to move the robot into collision with an obstacle (e.g. the table)

      * note the colliding links are colored red

      * since the position is unreachable, you can see the robot search through different positions as it tries to find a solution

      * try disabling the Use Collision-Aware IK setting on the Planning tab

      * see that the collisions are still detected, but the solver no longer searches for a collision-free solution

    * Try to plan a path through the obstacle

      * It may help to have "Collision-Aware IK" disabled when moving the Goal State

      * If the robot fails to plan, check the error log and try repeating the plan request

      * Because the default planners are sampling-based, they may produce different results on each execution

      * You can also try increasing the planning time to allow a successful plan to be created

      * Try different planning algorithms in this, more complex, planning task

    * Try adding a new obstacle to the scene:
      * Under the Scene Objects tab, add the `I-Beam.dae` CAD model
         * This file is located in the _industrial_training_ repo: `~/industrial_training/exercises/3.4/I-Beam.dae`
      * Move the I-Beam into an interesting position, using the manipulation handles
      * Press Publish Scene, to push the updated position to MoveIt
      * Try to plan around the obstacle
